* Arch Linux USB install
** Download

   Download Arch Linux bootstrap image.

   The Arch Linux bootstrap image is used to install Arch Linux from
   an already existing Linux install.

   #+BEGIN_SRC shell-script
     aria2c https://mirrors.kernel.org/archlinux/iso/2016.09.03/archlinux-bootstrap-2016.09.03-x86_64.tar.gz
   #+END_SRC

** Extract bootstrap image


   #+BEGIN_SRC shell-script
     tar xfv archlinux-bootstrap*
   #+END_SRC

** chroot into image


   #+BEGIN_SRC shell-script
   ./root.x86_64/bin/arch-chroot ./root.x86_64
   #+END_SRC

** Populate pacman keyring

   #+BEGIN_SRC shell-script
     pacman-key --init
     pacman-key --populate archlinux
   #+END_SRC

** Setup mirrors

   #+BEGIN_SRC shell-script
     cat <<EOF > /etc/pacman.d/mirrorlist
     Server = http://mirror.bytemark.co.uk/archlinux/\$repo/os/\$arch
     Server = http://mirror.cinosure.com/archlinux/\$repo/os/\$arch
     Server = http://mirrors.manchester.m247.com/arch-linux/\$repo/os/\$arch
     Server = http://www.mirrorservice.org/sites/ftp.archlinux.org/\$repo/os/\$arch
     Server = http://arch.serverspace.co.uk/arch/\$repo/os/\$arch
     Server = http://archlinux.mirrors.uk2.net/\$repo/os/\$arch
     EOF
   #+END_SRC

** Fetch package databases

   #+BEGIN_SRC shell-script
     pacman -Sy
   #+END_SRC

** Install =vim= for text editing

   #+BEGIN_SRC shell-script
   pacman -S vim
   #+END_SRC

** Partitioning

   #+BEGIN_SRC shell-script
     read disk

     # http://superuser.com/a/984637

     sed -e 's/\s*\([\+0-9a-zA-Z]*\).*/\1/' << EOF | fdisk $disk
         o       # clear partitions
         n       # new partition
         p       #   primary
         1       #   partition 1
                 #   default, start at beginning of disk
         +200M   #   200MB ESP
         t       #   change type
         ef      #     to ESP
         n       # new partition
         p       #   primary partition
         2       #   new partition 2
                 #   default, start just after previous partition
                 #   default, extend to end of disk
         a       # make partition bootable
         1       #   partition 1
         p       # print
         w       # write
         q       # finish
     EOF
   #+END_SRC

** Filesystems

   #+BEGIN_SRC shell-script
     pacman -S dosfstools
     mkfs.vfat /dev/${disk}1 # ESP
     mkfs.ext4 /dev/${disk}2 # main data
   #+END_SRC
   
** Mount

   #+BEGIN_SRC shell-script
     mount ${disk}2 /mnt
     mkdir /mnt/boot
     mount ${disk}1 /mnt/boot
   #+END_SRC

** Bootstrap

   #+BEGIN_SRC shell-script
   pacstrap /mnt base
   #+END_SRC
